import React, { useEffect, useRef, useState } from "react";
import Grid from "@mui/material/Grid";
import Paper from "@mui/material/Paper";
import Box from "@mui/material/Box";
import Typography from "@mui/material/Typography";
import Stack from "@mui/material/Stack";
import Button from "@mui/material/Button";
import IconButton from "@mui/material/IconButton";
import ArrowDropDownIcon from "@mui/icons-material/ArrowDropDown";
import TextField from "@mui/material/TextField";
import SendIcon from "@mui/icons-material/Send";
import DoneIcon from "@mui/icons-material/Done";
import DoneAllIcon from "@mui/icons-material/DoneAll";
import { useStoreState } from "easy-peasy";
import { getAuth } from "firebase/auth";
import {
  getDatabase,
  ref,
  child,
  get,
  onValue,
  push,
  query,
  serverTimestamp,
  limitToLast,
  update,
} from "firebase/database";
import { ToastContainer, toast } from "react-toastify";
import Avatar from "@mui/material/Avatar";
import Axios from "axios";

export default function ChatComponent() {
  const auth = getAuth();
  const myUid = auth.currentUser.uid;
  const recieverId = useStoreState((state) => state.chats.userId);
  const recieverDetails = useStoreState((state) => state.chats.userDetails);

  const [threadId, setThreadId] = useState();

  const getThreadId = () => {
    const dbRef = ref(getDatabase());
    get(child(dbRef, `users/${myUid}/contacts/${recieverId}/threadId`))
      .then((snapshot) => {
        if (snapshot.exists()) {
          setThreadId(snapshot.val());
        } else {
          toast.info("No thread Id available");
        }
      })
      .catch((error) => {
        toast.error(error.message);
      });
  };

  useEffect(() => {
    if (myUid && recieverId) {
      getThreadId();
    }
  }, [recieverId, threadId, myUid]);

  return (
    <>
      <ToastContainer />
      <Paper
        elevation={3}
        sx={{
          height: "84vh",
          display: "flex",
          flexDirection: "column",
        }}
      >
        {myUid && recieverId && threadId ? (
          <Chat
            recieverId={recieverId}
            recieverDetails={recieverDetails}
            threadId={threadId}
            myUid={myUid}
          />
        ) : (
          <Box
            sx={{
              width: "100%",
              height: "100%",
              display: "flex",
              justifyContent: "center",
              alignItems: "center",
            }}
          >
            <svg
              width="60%"
              viewBox="0 0 1625 980"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M1066.52 172.947H1062.52V63.4019C1062.52 55.0759 1060.88 46.8314 1057.7 39.1391C1054.51 31.4468 1049.84 24.4574 1043.95 18.57C1038.06 12.6826 1031.07 8.01245 1023.38 4.8262C1015.69 1.63995 1007.45 7.87946e-06 999.12 1.54785e-10H767.033C750.218 -3.71302e-05 734.091 6.67975 722.201 18.5699C710.311 30.46 703.631 46.5865 703.631 63.4017V664.376C703.631 681.191 710.311 697.318 722.201 709.208C734.091 721.098 750.217 727.778 767.033 727.778H999.119C1015.93 727.778 1032.06 721.098 1043.95 709.208C1055.84 697.318 1062.52 681.192 1062.52 664.376V250.924H1066.52L1066.52 172.947Z"
                fill="#E6E6E6"
              />
              <path
                d="M1049.03 63.8444V663.934C1049.03 676.492 1044.04 688.536 1035.16 697.416C1026.28 706.295 1014.23 711.284 1001.68 711.284H768.477C755.919 711.284 743.875 706.295 734.995 697.416C726.116 688.536 721.127 676.492 721.127 663.934V63.8444C721.127 51.2865 726.116 39.2429 734.995 30.3631C743.875 21.4833 755.919 16.4946 768.477 16.4944H796.767C795.377 19.9104 794.847 23.6156 795.225 27.2842C795.603 30.9527 796.877 34.4722 798.934 37.5331C800.991 40.5939 803.769 43.1022 807.024 44.8375C810.278 46.5727 813.909 47.4817 817.597 47.4844H950.557C954.245 47.4816 957.875 46.5727 961.13 44.8374C964.384 43.1022 967.162 40.5938 969.219 37.533C971.277 34.4722 972.55 30.9527 972.928 27.2841C973.306 23.6156 972.777 19.9104 971.387 16.4944H1001.68C1014.23 16.4946 1026.28 21.4833 1035.16 30.3631C1044.04 39.2429 1049.03 51.2865 1049.03 63.8444V63.8444Z"
                fill="white"
              />
              <path
                d="M435.419 598.362C433.606 598.363 431.854 597.708 430.486 596.519L419.365 586.818C417.869 585.509 416.952 583.661 416.815 581.677C416.678 579.693 417.333 577.737 418.636 576.234L499.497 483.523C499.657 483.334 499.829 483.155 500.012 482.987C501.368 481.714 503.148 480.99 505.008 480.957C506.867 480.923 508.673 481.582 510.074 482.806L521.202 492.504C521.944 493.152 522.552 493.939 522.989 494.822C523.427 495.704 523.686 496.664 523.753 497.647L523.753 497.649C523.82 498.632 523.693 499.618 523.379 500.552C523.064 501.486 522.569 502.348 521.921 503.09L441.071 595.8C440.366 596.605 439.497 597.251 438.522 597.693C437.548 598.135 436.49 598.363 435.419 598.362L435.419 598.362Z"
                fill="#6C63FF"
              />
              <path
                d="M583.974 501.911C583.194 501.91 582.42 501.791 581.676 501.559C580.737 501.261 579.865 500.779 579.113 500.143C578.36 499.507 577.741 498.728 577.29 497.851L570.529 484.73C569.76 483.247 569.51 481.55 569.82 479.908C570.129 478.266 570.979 476.776 572.235 475.674C572.694 475.261 573.204 474.909 573.753 474.627L683.095 418.257C684.863 417.349 686.919 417.179 688.812 417.783C690.705 418.388 692.282 419.717 693.198 421.481L699.958 434.602C700.866 436.371 701.035 438.427 700.431 440.32C699.826 442.214 698.496 443.791 696.732 444.706L587.393 501.076C586.337 501.624 585.164 501.91 583.974 501.911V501.911Z"
                fill="#6C63FF"
              />
              <path
                d="M582.004 505.091C580.61 505.085 579.244 504.695 578.058 503.964C576.871 503.232 575.909 502.188 575.277 500.945L568.657 487.755C567.855 486.161 567.649 484.333 568.079 482.6C568.108 482.468 568.152 482.323 568.194 482.182L568.234 482.051C568.351 481.706 568.466 481.215 568.6 480.646L568.678 480.316C569.167 478.194 569.776 475.551 571 474.45C571.152 474.307 571.324 474.187 571.511 474.093L619.515 444.994C620.402 444.536 621.372 444.26 622.367 444.182C623.362 444.103 624.363 444.224 625.311 444.537C627.195 445.166 628.755 446.514 629.651 448.288L641.773 473.272C642.659 475.05 642.804 477.107 642.177 478.992C641.55 480.877 640.201 482.437 638.426 483.329L585.268 504.317C584.256 504.828 583.138 505.094 582.004 505.091Z"
                fill="#2F2E41"
              />
              <path
                d="M546.056 435.848C575.614 435.848 599.575 411.887 599.575 382.329C599.575 352.771 575.614 328.81 546.056 328.81C516.498 328.81 492.537 352.771 492.537 382.329C492.537 411.887 516.498 435.848 546.056 435.848Z"
                fill="#6C63FF"
              />
              <path
                d="M532.624 728.671H517.864C515.875 728.669 513.969 727.878 512.563 726.472C511.157 725.066 510.366 723.16 510.364 721.171V596.161C510.366 594.173 511.157 592.266 512.563 590.86C513.969 589.454 515.875 588.663 517.864 588.661H532.624C533.553 588.659 534.475 588.834 535.339 589.177C536.693 589.698 537.866 590.604 538.712 591.783C539.559 592.962 540.042 594.363 540.102 595.813C540.12 595.929 540.127 596.045 540.124 596.161V721.171C540.122 723.16 539.331 725.066 537.925 726.472C536.519 727.878 534.612 728.669 532.624 728.671V728.671Z"
                fill="#6C63FF"
              />
              <path
                d="M614.894 652.031C614.823 651.914 614.746 651.801 614.664 651.691C614.462 651.214 614.207 650.762 613.904 650.341L588.744 615.141L568.014 586.151H532.654L535.154 589.641L539.604 595.871L553.394 615.151L582.944 656.481L555.554 711.501C554.434 713.741 556.344 716.961 559.794 718.681L573.004 725.261C574.315 725.931 575.762 726.293 577.234 726.321C579.094 726.321 580.644 725.631 581.294 724.321L615.344 655.921C615.612 655.289 615.712 654.599 615.633 653.917C615.554 653.235 615.299 652.585 614.894 652.031V652.031Z"
                fill="#6C63FF"
              />
              <path
                d="M494.555 537.762C492.597 537.752 490.72 536.98 489.323 535.608L469.296 516.401C468.124 515.252 467.365 513.746 467.139 512.12C467.084 511.783 467.055 511.443 467.054 511.101C467.05 510.715 467.079 510.328 467.141 509.947C467.366 508.37 468.095 506.908 469.219 505.779L511.807 468.963C512.961 467.773 515.888 468.02 518.47 468.237L518.86 468.269C519.336 468.321 519.814 468.348 520.292 468.351C520.469 468.37 520.674 468.361 520.863 468.37C522.655 468.496 524.343 469.256 525.625 470.514L536.135 480.875C537.549 482.273 538.352 484.175 538.366 486.163C538.38 488.152 537.605 490.065 536.21 491.482L499.98 535.469C499.278 536.198 498.435 536.778 497.503 537.172C496.57 537.566 495.567 537.766 494.555 537.762V537.762Z"
                fill="#2F2E41"
              />
              <path
                d="M543.932 404.165L543.876 402.165C547.597 402.062 550.877 401.828 553.342 400.027C554.041 399.488 554.615 398.804 555.026 398.023C555.437 397.241 555.675 396.381 555.723 395.499C555.766 394.96 555.685 394.419 555.485 393.917C555.285 393.415 554.972 392.966 554.57 392.604C552.934 391.223 550.301 391.67 548.382 392.55L546.728 393.309L549.901 370.118L551.882 370.39L549.183 390.116C551.791 389.35 554.207 389.68 555.861 391.077C556.497 391.632 556.995 392.326 557.318 393.105C557.641 393.884 557.779 394.728 557.722 395.569C557.663 396.754 557.347 397.911 556.794 398.96C556.241 400.009 555.465 400.925 554.521 401.643C551.355 403.957 547.239 404.072 543.932 404.165Z"
                fill="#2F2E41"
              />
              <path
                d="M572.453 372.091H561.682V374.091H572.453V372.091Z"
                fill="#2F2E41"
              />
              <path
                d="M538.453 372.091H527.682V374.091H538.453V372.091Z"
                fill="#2F2E41"
              />
              <path
                d="M594.634 615.651H499.634C495.989 615.651 493.134 609.797 493.134 602.324V508.651C493.137 497.174 496.794 485.996 503.576 476.736C510.359 467.477 519.913 460.618 530.855 457.154C530.71 456.496 530.635 455.825 530.634 455.151C530.637 452.633 531.638 450.218 533.419 448.437C535.2 446.656 537.615 445.654 540.134 445.651H554.134C556.652 445.654 559.067 446.656 560.848 448.437C562.629 450.218 563.631 452.633 563.634 455.151C563.632 455.826 563.558 456.499 563.412 457.158C568.698 458.823 573.694 461.297 578.222 464.493C579.153 465.144 580.072 465.837 580.95 466.554C588.724 472.786 594.618 481.052 597.975 490.434C598.526 491.958 599.015 493.537 599.428 495.126L599.428 495.127C600.562 499.546 601.135 504.09 601.134 508.651V602.324C601.134 609.611 598.377 615.422 594.843 615.626C594.775 615.644 594.704 615.653 594.634 615.651V615.651Z"
                fill="#2F2E41"
              />
              <path
                d="M541.634 649.651H503.634C501.91 649.649 500.258 648.964 499.04 647.745C497.821 646.527 497.136 644.875 497.134 643.151V613.151C497.136 611.428 497.821 609.776 499.04 608.557C500.258 607.339 501.91 606.653 503.634 606.651H541.634C543.357 606.653 545.009 607.339 546.228 608.557C547.446 609.776 548.132 611.428 548.134 613.151V643.151C548.132 644.875 547.446 646.527 546.228 647.745C545.009 648.964 543.357 649.649 541.634 649.651Z"
                fill="#2F2E41"
              />
              <path
                d="M565.055 650.33C563.728 650.33 562.432 649.924 561.342 649.167C560.251 648.41 559.419 647.337 558.955 646.094L548.506 617.972C547.908 616.356 547.975 614.568 548.693 613.002C549.411 611.435 550.721 610.217 552.335 609.615L587.956 596.38C589.572 595.782 591.359 595.849 592.926 596.567C594.493 597.285 595.711 598.594 596.313 600.209L606.762 628.331C607.36 629.947 607.293 631.734 606.575 633.301C605.857 634.868 604.547 636.086 602.932 636.688L567.312 649.923C566.59 650.192 565.825 650.33 565.055 650.33V650.33Z"
                fill="#2F2E41"
              />
              <path
                d="M520.894 357.016C530.813 351.284 542.841 355.681 553.086 358.086C564.033 360.655 575.605 361.211 585.923 356.02C594.511 351.7 601.329 343.183 602.147 333.424C602.911 324.302 597.773 314.582 589.083 311.16C580.23 307.673 568.961 312.235 565.732 321.32L568.474 320.961C557.863 307.031 544.784 292.657 526.533 289.945C518.344 288.728 509.605 289.834 502.608 294.51C496.05 298.893 491.826 305.661 489.336 313.03C486.446 321.581 485.691 330.737 485.168 339.692C485.055 341.62 488.055 341.614 488.168 339.692C488.989 325.629 490.321 308.668 501.819 298.843C507.787 293.743 515.756 291.968 523.45 292.584C531.624 293.238 539.201 296.626 545.771 301.419C553.644 307.163 560.014 314.77 565.883 322.475C566.039 322.721 566.261 322.917 566.524 323.04C566.787 323.163 567.08 323.208 567.368 323.171C567.656 323.133 567.928 323.014 568.15 322.827C568.373 322.641 568.538 322.394 568.625 322.117C571.216 314.825 580.311 311.424 587.388 313.729C595.392 316.335 599.818 325.412 599.147 333.424C598.378 342.6 591.356 350.317 583.237 353.99C573.456 358.415 562.739 357.334 552.617 354.891C541.866 352.296 529.722 348.448 519.38 354.426C519.051 354.633 518.816 354.961 518.723 355.339C518.631 355.717 518.689 356.116 518.886 356.452C519.082 356.788 519.401 357.035 519.776 357.14C520.151 357.245 520.552 357.201 520.894 357.016V357.016Z"
                fill="#2F2E41"
              />
              <path
                d="M780.907 72.1511C776.705 72.1511 772.544 72.9788 768.661 74.5869C764.779 76.1951 761.251 78.5522 758.28 81.5236C755.308 84.4951 752.951 88.0227 751.343 91.9051C749.735 95.7875 748.907 99.9487 748.907 104.151C748.907 108.353 749.735 112.514 751.343 116.397C752.951 120.279 755.308 123.807 758.28 126.778C761.251 129.75 764.779 132.107 768.661 133.715C772.544 135.323 776.705 136.151 780.907 136.151H780.907C789.394 136.151 797.534 132.78 803.535 126.779C809.536 120.777 812.907 112.638 812.907 104.151C812.907 95.6642 809.536 87.5249 803.535 81.5237C797.534 75.5225 789.394 72.1511 780.907 72.1511Z"
                fill="#F2F2F2"
              />
              <path
                d="M1013.25 131.151H845.246C843.124 131.151 841.09 130.309 839.589 128.808C838.089 127.308 837.246 125.273 837.246 123.151C837.246 121.03 838.089 118.995 839.589 117.495C841.09 115.994 843.124 115.151 845.246 115.151H1013.25C1015.37 115.151 1017.4 115.994 1018.9 117.495C1020.4 118.995 1021.25 121.03 1021.25 123.151C1021.25 125.273 1020.4 127.308 1018.9 128.808C1017.4 130.309 1015.37 131.151 1013.25 131.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M898.246 97.1514H845.246C843.124 97.1514 841.09 96.3085 839.589 94.8082C838.089 93.3079 837.246 91.2731 837.246 89.1514C837.246 87.0296 838.089 84.9948 839.589 83.4945C841.09 81.9942 843.124 81.1514 845.246 81.1514H898.246C900.368 81.1514 902.403 81.9942 903.903 83.4945C905.403 84.9948 906.246 87.0296 906.246 89.1514C906.246 91.2731 905.403 93.3079 903.903 94.8082C902.403 96.3085 900.368 97.1514 898.246 97.1514Z"
                fill="#F2F2F2"
              />
              <path
                d="M780.907 206.151C776.705 206.151 772.544 206.979 768.661 208.587C764.779 210.195 761.251 212.552 758.28 215.524C755.308 218.495 752.951 222.023 751.343 225.905C749.735 229.788 748.907 233.949 748.907 238.151C748.907 242.353 749.735 246.514 751.343 250.397C752.951 254.279 755.308 257.807 758.28 260.778C761.251 263.75 764.779 266.107 768.661 267.715C772.544 269.323 776.705 270.151 780.907 270.151H780.907C789.394 270.151 797.534 266.78 803.535 260.779C809.536 254.777 812.907 246.638 812.907 238.151C812.907 229.664 809.536 221.525 803.535 215.524C797.534 209.523 789.394 206.151 780.907 206.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M1013.25 265.151H845.246C843.124 265.151 841.09 264.309 839.589 262.808C838.089 261.308 837.246 259.273 837.246 257.151C837.246 255.03 838.089 252.995 839.589 251.495C841.09 249.994 843.124 249.151 845.246 249.151H1013.25C1015.37 249.151 1017.4 249.994 1018.9 251.495C1020.4 252.995 1021.25 255.03 1021.25 257.151C1021.25 259.273 1020.4 261.308 1018.9 262.808C1017.4 264.309 1015.37 265.151 1013.25 265.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M898.246 231.151H845.246C843.124 231.151 841.09 230.309 839.589 228.808C838.089 227.308 837.246 225.273 837.246 223.151C837.246 221.03 838.089 218.995 839.589 217.495C841.09 215.994 843.124 215.151 845.246 215.151H898.246C900.368 215.151 902.403 215.994 903.903 217.495C905.403 218.995 906.246 221.03 906.246 223.151C906.246 225.273 905.403 227.308 903.903 228.808C902.403 230.309 900.368 231.151 898.246 231.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M780.907 474.151C772.42 474.151 764.281 477.522 758.28 483.524C752.279 489.525 748.907 497.664 748.907 506.151C748.907 514.638 752.279 522.777 758.28 528.778C764.281 534.78 772.42 538.151 780.907 538.151H780.907C789.394 538.151 797.534 534.78 803.535 528.779C809.536 522.777 812.907 514.638 812.907 506.151C812.907 497.664 809.536 489.525 803.535 483.524C797.534 477.523 789.394 474.151 780.907 474.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M1013.25 533.151H845.246C843.124 533.151 841.09 532.309 839.589 530.808C838.089 529.308 837.246 527.273 837.246 525.151C837.246 523.03 838.089 520.995 839.589 519.495C841.09 517.994 843.124 517.151 845.246 517.151H1013.25C1015.37 517.151 1017.4 517.994 1018.9 519.495C1020.4 520.995 1021.25 523.03 1021.25 525.151C1021.25 527.273 1020.4 529.308 1018.9 530.808C1017.4 532.309 1015.37 533.151 1013.25 533.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M898.246 499.151H845.246C843.124 499.151 841.09 498.309 839.589 496.808C838.089 495.308 837.246 493.273 837.246 491.151C837.246 489.03 838.089 486.995 839.589 485.495C841.09 483.994 843.124 483.151 845.246 483.151H898.246C900.368 483.151 902.403 483.994 903.903 485.495C905.403 486.995 906.246 489.03 906.246 491.151C906.246 493.273 905.403 495.308 903.903 496.808C902.403 498.309 900.368 499.151 898.246 499.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M780.907 608.151C776.705 608.151 772.544 608.979 768.661 610.587C764.779 612.195 761.251 614.552 758.28 617.524C755.308 620.495 752.951 624.023 751.343 627.905C749.735 631.788 748.907 635.949 748.907 640.151C748.907 644.353 749.735 648.514 751.343 652.397C752.951 656.279 755.308 659.807 758.28 662.778C761.251 665.75 764.779 668.107 768.661 669.715C772.544 671.323 776.705 672.151 780.907 672.151H780.907C789.394 672.151 797.534 668.78 803.535 662.779C809.536 656.777 812.907 648.638 812.907 640.151C812.907 631.664 809.536 623.525 803.535 617.524C797.534 611.523 789.394 608.151 780.907 608.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M1013.25 667.151H845.246C843.124 667.151 841.09 666.309 839.589 664.808C838.089 663.308 837.246 661.273 837.246 659.151C837.246 657.03 838.089 654.995 839.589 653.495C841.09 651.994 843.124 651.151 845.246 651.151H1013.25C1015.37 651.151 1017.4 651.994 1018.9 653.495C1020.4 654.995 1021.25 657.03 1021.25 659.151C1021.25 661.273 1020.4 663.308 1018.9 664.808C1017.4 666.309 1015.37 667.151 1013.25 667.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M898.246 633.151H845.246C843.124 633.151 841.09 632.309 839.589 630.808C838.089 629.308 837.246 627.273 837.246 625.151C837.246 623.03 838.089 620.995 839.589 619.495C841.09 617.994 843.124 617.151 845.246 617.151H898.246C900.368 617.151 902.403 617.994 903.903 619.495C905.403 620.995 906.246 623.03 906.246 625.151C906.246 627.273 905.403 629.308 903.903 630.808C902.403 632.309 900.368 633.151 898.246 633.151Z"
                fill="#F2F2F2"
              />
              <path
                d="M1078.08 449.151H692.077C687.702 449.146 683.508 447.406 680.415 444.313C677.322 441.22 675.582 437.026 675.577 432.651V308.651C675.582 304.277 677.322 300.083 680.415 296.99C683.508 293.896 687.702 292.156 692.077 292.151H1078.08C1082.45 292.156 1086.65 293.896 1089.74 296.99C1092.83 300.083 1094.57 304.277 1094.58 308.651V432.651C1094.57 437.026 1092.83 441.22 1089.74 444.313C1086.65 447.406 1082.45 449.146 1078.08 449.151Z"
                fill="white"
              />
              <path
                d="M780.907 338.651C772.42 338.651 764.281 342.023 758.28 348.024C752.279 354.025 748.907 362.164 748.907 370.651C748.907 379.138 752.279 387.278 758.28 393.279C764.281 399.28 772.42 402.651 780.907 402.651H780.907C789.394 402.651 797.534 399.28 803.535 393.279C809.536 387.278 812.907 379.138 812.907 370.651C812.907 362.164 809.536 354.025 803.535 348.024C797.534 342.023 789.394 338.651 780.907 338.651Z"
                fill="#6C63FF"
              />
              <path
                d="M1013.25 397.651H845.246C843.124 397.651 841.09 396.809 839.589 395.308C838.089 393.808 837.246 391.773 837.246 389.651C837.246 387.53 838.089 385.495 839.589 383.995C841.09 382.494 843.124 381.651 845.246 381.651H1013.25C1015.37 381.651 1017.4 382.494 1018.9 383.995C1020.4 385.495 1021.25 387.53 1021.25 389.651C1021.25 391.773 1020.4 393.808 1018.9 395.308C1017.4 396.809 1015.37 397.651 1013.25 397.651Z"
                fill="#CCCCCC"
              />
              <path
                d="M898.246 363.651H845.246C843.124 363.651 841.09 362.809 839.589 361.308C838.089 359.808 837.246 357.773 837.246 355.651C837.246 353.53 838.089 351.495 839.589 349.995C841.09 348.494 843.124 347.651 845.246 347.651H898.246C900.368 347.651 902.403 348.494 903.903 349.995C905.403 351.495 906.246 353.53 906.246 355.651C906.246 357.773 905.403 359.808 903.903 361.308C902.403 362.809 900.368 363.651 898.246 363.651Z"
                fill="#CCCCCC"
              />
              <path
                d="M1078.08 449.151H692.077C687.702 449.146 683.508 447.406 680.415 444.313C677.322 441.22 675.582 437.026 675.577 432.651V308.651C675.582 304.277 677.322 300.083 680.415 296.99C683.508 293.896 687.702 292.156 692.077 292.151H1078.08C1082.45 292.156 1086.65 293.896 1089.74 296.99C1092.83 300.083 1094.57 304.277 1094.58 308.651V432.651C1094.57 437.026 1092.83 441.22 1089.74 444.313C1086.65 447.406 1082.45 449.146 1078.08 449.151ZM692.077 293.151C687.967 293.156 684.027 294.791 681.122 297.696C678.216 300.602 676.581 304.542 676.577 308.651V432.651C676.581 436.761 678.216 440.701 681.122 443.606C684.027 446.512 687.967 448.147 692.077 448.151H1078.08C1082.19 448.147 1086.13 446.512 1089.03 443.606C1091.94 440.701 1093.57 436.761 1093.58 432.651V308.651C1093.57 304.542 1091.94 300.602 1089.03 297.696C1086.13 294.791 1082.19 293.156 1078.08 293.151H692.077Z"
                fill="#3F3D56"
              />
              <path
                d="M777.871 383.941C777.029 383.943 776.209 383.67 775.535 383.165L775.493 383.133L766.693 376.402C765.871 375.77 765.333 374.838 765.198 373.811C765.063 372.783 765.341 371.744 765.972 370.921C766.602 370.098 767.534 369.56 768.561 369.424C769.589 369.287 770.629 369.565 771.452 370.195L777.152 374.566L790.621 356.993C790.933 356.586 791.323 356.244 791.767 355.987C792.212 355.73 792.702 355.564 793.211 355.496C793.72 355.429 794.237 355.463 794.733 355.595C795.229 355.728 795.694 355.957 796.102 356.269L796.103 356.27L796.019 356.386L796.105 356.27C796.927 356.902 797.465 357.834 797.6 358.862C797.736 359.889 797.458 360.929 796.828 361.752L780.985 382.412C780.619 382.888 780.147 383.273 779.608 383.537C779.069 383.802 778.475 383.938 777.875 383.937L777.871 383.941Z"
                fill="white"
              />
              <path
                d="M1260 729.151H288C287.735 729.151 287.48 729.046 287.293 728.858C287.105 728.671 287 728.417 287 728.151C287 727.886 287.105 727.632 287.293 727.444C287.48 727.257 287.735 727.151 288 727.151H1260C1260.27 727.151 1260.52 727.257 1260.71 727.444C1260.89 727.632 1261 727.886 1261 728.151C1261 728.417 1260.89 728.671 1260.71 728.858C1260.52 729.046 1260.27 729.151 1260 729.151Z"
                fill="#CCCCCC"
              />
              <path
                d="M17.2656 816.281V843H8.26562V774.75H33.4375C40.9062 774.75 46.75 776.656 50.9688 780.469C55.2188 784.281 57.3438 789.328 57.3438 795.609C57.3438 802.234 55.2656 807.344 51.1094 810.938C46.9844 814.5 41.0625 816.281 33.3438 816.281H17.2656ZM17.2656 808.922H33.4375C38.25 808.922 41.9375 807.797 44.5 805.547C47.0625 803.266 48.3438 799.984 48.3438 795.703C48.3438 791.641 47.0625 788.391 44.5 785.953C41.9375 783.516 38.4219 782.25 33.9531 782.156H17.2656V808.922ZM76.8906 843H68.2188V771H76.8906V843ZM111.859 843.938C104.984 843.938 99.3906 841.688 95.0781 837.188C90.7656 832.656 88.6094 826.609 88.6094 819.047V817.453C88.6094 812.422 89.5625 807.938 91.4688 804C93.4062 800.031 96.0938 796.938 99.5312 794.719C103 792.469 106.75 791.344 110.781 791.344C117.375 791.344 122.5 793.516 126.156 797.859C129.812 802.203 131.641 808.422 131.641 816.516V820.125H97.2812C97.4062 825.125 98.8594 829.172 101.641 832.266C104.453 835.328 108.016 836.859 112.328 836.859C115.391 836.859 117.984 836.234 120.109 834.984C122.234 833.734 124.094 832.078 125.688 830.016L130.984 834.141C126.734 840.672 120.359 843.938 111.859 843.938ZM110.781 798.469C107.281 798.469 104.344 799.75 101.969 802.312C99.5938 804.844 98.125 808.406 97.5625 813H122.969V812.344C122.719 807.938 121.531 804.531 119.406 802.125C117.281 799.688 114.406 798.469 110.781 798.469ZM173.031 843C172.531 842 172.125 840.219 171.812 837.656C167.781 841.844 162.969 843.938 157.375 843.938C152.375 843.938 148.266 842.531 145.047 839.719C141.859 836.875 140.266 833.281 140.266 828.938C140.266 823.656 142.266 819.562 146.266 816.656C150.297 813.719 155.953 812.25 163.234 812.25H171.672V808.266C171.672 805.234 170.766 802.828 168.953 801.047C167.141 799.234 164.469 798.328 160.938 798.328C157.844 798.328 155.25 799.109 153.156 800.672C151.062 802.234 150.016 804.125 150.016 806.344H141.297C141.297 803.812 142.188 801.375 143.969 799.031C145.781 796.656 148.219 794.781 151.281 793.406C154.375 792.031 157.766 791.344 161.453 791.344C167.297 791.344 171.875 792.812 175.188 795.75C178.5 798.656 180.219 802.672 180.344 807.797V831.141C180.344 835.797 180.938 839.5 182.125 842.25V843H173.031ZM158.641 836.391C161.359 836.391 163.938 835.688 166.375 834.281C168.812 832.875 170.578 831.047 171.672 828.797V818.391H164.875C154.25 818.391 148.938 821.5 148.938 827.719C148.938 830.438 149.844 832.562 151.656 834.094C153.469 835.625 155.797 836.391 158.641 836.391ZM223.469 829.547C223.469 827.203 222.578 825.391 220.797 824.109C219.047 822.797 215.969 821.672 211.562 820.734C207.188 819.797 203.703 818.672 201.109 817.359C198.547 816.047 196.641 814.484 195.391 812.672C194.172 810.859 193.562 808.703 193.562 806.203C193.562 802.047 195.312 798.531 198.812 795.656C202.344 792.781 206.844 791.344 212.312 791.344C218.062 791.344 222.719 792.828 226.281 795.797C229.875 798.766 231.672 802.562 231.672 807.188H222.953C222.953 804.812 221.938 802.766 219.906 801.047C217.906 799.328 215.375 798.469 212.312 798.469C209.156 798.469 206.688 799.156 204.906 800.531C203.125 801.906 202.234 803.703 202.234 805.922C202.234 808.016 203.062 809.594 204.719 810.656C206.375 811.719 209.359 812.734 213.672 813.703C218.016 814.672 221.531 815.828 224.219 817.172C226.906 818.516 228.891 820.141 230.172 822.047C231.484 823.922 232.141 826.219 232.141 828.938C232.141 833.469 230.328 837.109 226.703 839.859C223.078 842.578 218.375 843.938 212.594 843.938C208.531 843.938 204.938 843.219 201.812 841.781C198.688 840.344 196.234 838.344 194.453 835.781C192.703 833.188 191.828 830.391 191.828 827.391H200.5C200.656 830.297 201.812 832.609 203.969 834.328C206.156 836.016 209.031 836.859 212.594 836.859C215.875 836.859 218.5 836.203 220.469 834.891C222.469 833.547 223.469 831.766 223.469 829.547ZM264.484 843.938C257.609 843.938 252.016 841.688 247.703 837.188C243.391 832.656 241.234 826.609 241.234 819.047V817.453C241.234 812.422 242.188 807.938 244.094 804C246.031 800.031 248.719 796.938 252.156 794.719C255.625 792.469 259.375 791.344 263.406 791.344C270 791.344 275.125 793.516 278.781 797.859C282.438 802.203 284.266 808.422 284.266 816.516V820.125H249.906C250.031 825.125 251.484 829.172 254.266 832.266C257.078 835.328 260.641 836.859 264.953 836.859C268.016 836.859 270.609 836.234 272.734 834.984C274.859 833.734 276.719 832.078 278.312 830.016L283.609 834.141C279.359 840.672 272.984 843.938 264.484 843.938ZM263.406 798.469C259.906 798.469 256.969 799.75 254.594 802.312C252.219 804.844 250.75 808.406 250.188 813H275.594V812.344C275.344 807.938 274.156 804.531 272.031 802.125C269.906 799.688 267.031 798.469 263.406 798.469ZM338.5 836.859C341.594 836.859 344.297 835.922 346.609 834.047C348.922 832.172 350.203 829.828 350.453 827.016H358.656C358.5 829.922 357.5 832.688 355.656 835.312C353.812 837.938 351.344 840.031 348.25 841.594C345.188 843.156 341.938 843.938 338.5 843.938C331.594 843.938 326.094 841.641 322 837.047C317.938 832.422 315.906 826.109 315.906 818.109V816.656C315.906 811.719 316.812 807.328 318.625 803.484C320.438 799.641 323.031 796.656 326.406 794.531C329.812 792.406 333.828 791.344 338.453 791.344C344.141 791.344 348.859 793.047 352.609 796.453C356.391 799.859 358.406 804.281 358.656 809.719H350.453C350.203 806.438 348.953 803.75 346.703 801.656C344.484 799.531 341.734 798.469 338.453 798.469C334.047 798.469 330.625 800.062 328.188 803.25C325.781 806.406 324.578 810.984 324.578 816.984V818.625C324.578 824.469 325.781 828.969 328.188 832.125C330.594 835.281 334.031 836.859 338.5 836.859ZM377.078 798.422C380.922 793.703 385.922 791.344 392.078 791.344C402.797 791.344 408.203 797.391 408.297 809.484V843H399.625V809.438C399.594 805.781 398.75 803.078 397.094 801.328C395.469 799.578 392.922 798.703 389.453 798.703C386.641 798.703 384.172 799.453 382.047 800.953C379.922 802.453 378.266 804.422 377.078 806.859V843H368.406V771H377.078V798.422ZM418.984 817.172C418.984 812.203 419.953 807.734 421.891 803.766C423.859 799.797 426.578 796.734 430.047 794.578C433.547 792.422 437.531 791.344 442 791.344C448.906 791.344 454.484 793.734 458.734 798.516C463.016 803.297 465.156 809.656 465.156 817.594V818.203C465.156 823.141 464.203 827.578 462.297 831.516C460.422 835.422 457.719 838.469 454.188 840.656C450.688 842.844 446.656 843.938 442.094 843.938C435.219 843.938 429.641 841.547 425.359 836.766C421.109 831.984 418.984 825.656 418.984 817.781V817.172ZM427.703 818.203C427.703 823.828 429 828.344 431.594 831.75C434.219 835.156 437.719 836.859 442.094 836.859C446.5 836.859 450 835.141 452.594 831.703C455.188 828.234 456.484 823.391 456.484 817.172C456.484 811.609 455.156 807.109 452.5 803.672C449.875 800.203 446.375 798.469 442 798.469C437.719 798.469 434.266 800.172 431.641 803.578C429.016 806.984 427.703 811.859 427.703 818.203ZM473.734 817.172C473.734 812.203 474.703 807.734 476.641 803.766C478.609 799.797 481.328 796.734 484.797 794.578C488.297 792.422 492.281 791.344 496.75 791.344C503.656 791.344 509.234 793.734 513.484 798.516C517.766 803.297 519.906 809.656 519.906 817.594V818.203C519.906 823.141 518.953 827.578 517.047 831.516C515.172 835.422 512.469 838.469 508.938 840.656C505.438 842.844 501.406 843.938 496.844 843.938C489.969 843.938 484.391 841.547 480.109 836.766C475.859 831.984 473.734 825.656 473.734 817.781V817.172ZM482.453 818.203C482.453 823.828 483.75 828.344 486.344 831.75C488.969 835.156 492.469 836.859 496.844 836.859C501.25 836.859 504.75 835.141 507.344 831.703C509.938 828.234 511.234 823.391 511.234 817.172C511.234 811.609 509.906 807.109 507.25 803.672C504.625 800.203 501.125 798.469 496.75 798.469C492.469 798.469 489.016 800.172 486.391 803.578C483.766 806.984 482.453 811.859 482.453 818.203ZM560.312 829.547C560.312 827.203 559.422 825.391 557.641 824.109C555.891 822.797 552.812 821.672 548.406 820.734C544.031 819.797 540.547 818.672 537.953 817.359C535.391 816.047 533.484 814.484 532.234 812.672C531.016 810.859 530.406 808.703 530.406 806.203C530.406 802.047 532.156 798.531 535.656 795.656C539.188 792.781 543.688 791.344 549.156 791.344C554.906 791.344 559.562 792.828 563.125 795.797C566.719 798.766 568.516 802.562 568.516 807.188H559.797C559.797 804.812 558.781 802.766 556.75 801.047C554.75 799.328 552.219 798.469 549.156 798.469C546 798.469 543.531 799.156 541.75 800.531C539.969 801.906 539.078 803.703 539.078 805.922C539.078 808.016 539.906 809.594 541.562 810.656C543.219 811.719 546.203 812.734 550.516 813.703C554.859 814.672 558.375 815.828 561.062 817.172C563.75 818.516 565.734 820.141 567.016 822.047C568.328 823.922 568.984 826.219 568.984 828.938C568.984 833.469 567.172 837.109 563.547 839.859C559.922 842.578 555.219 843.938 549.438 843.938C545.375 843.938 541.781 843.219 538.656 841.781C535.531 840.344 533.078 838.344 531.297 835.781C529.547 833.188 528.672 830.391 528.672 827.391H537.344C537.5 830.297 538.656 832.609 540.812 834.328C543 836.016 545.875 836.859 549.438 836.859C552.719 836.859 555.344 836.203 557.312 834.891C559.312 833.547 560.312 831.766 560.312 829.547ZM601.328 843.938C594.453 843.938 588.859 841.688 584.547 837.188C580.234 832.656 578.078 826.609 578.078 819.047V817.453C578.078 812.422 579.031 807.938 580.938 804C582.875 800.031 585.562 796.938 589 794.719C592.469 792.469 596.219 791.344 600.25 791.344C606.844 791.344 611.969 793.516 615.625 797.859C619.281 802.203 621.109 808.422 621.109 816.516V820.125H586.75C586.875 825.125 588.328 829.172 591.109 832.266C593.922 835.328 597.484 836.859 601.797 836.859C604.859 836.859 607.453 836.234 609.578 834.984C611.703 833.734 613.562 832.078 615.156 830.016L620.453 834.141C616.203 840.672 609.828 843.938 601.328 843.938ZM600.25 798.469C596.75 798.469 593.812 799.75 591.438 802.312C589.062 804.844 587.594 808.406 587.031 813H612.438V812.344C612.188 807.938 611 804.531 608.875 802.125C606.75 799.688 603.875 798.469 600.25 798.469ZM686.312 843C685.812 842 685.406 840.219 685.094 837.656C681.062 841.844 676.25 843.938 670.656 843.938C665.656 843.938 661.547 842.531 658.328 839.719C655.141 836.875 653.547 833.281 653.547 828.938C653.547 823.656 655.547 819.562 659.547 816.656C663.578 813.719 669.234 812.25 676.516 812.25H684.953V808.266C684.953 805.234 684.047 802.828 682.234 801.047C680.422 799.234 677.75 798.328 674.219 798.328C671.125 798.328 668.531 799.109 666.438 800.672C664.344 802.234 663.297 804.125 663.297 806.344H654.578C654.578 803.812 655.469 801.375 657.25 799.031C659.062 796.656 661.5 794.781 664.562 793.406C667.656 792.031 671.047 791.344 674.734 791.344C680.578 791.344 685.156 792.812 688.469 795.75C691.781 798.656 693.5 802.672 693.625 807.797V831.141C693.625 835.797 694.219 839.5 695.406 842.25V843H686.312ZM671.922 836.391C674.641 836.391 677.219 835.688 679.656 834.281C682.094 832.875 683.859 831.047 684.953 828.797V818.391H678.156C667.531 818.391 662.219 821.5 662.219 827.719C662.219 830.438 663.125 832.562 664.938 834.094C666.75 835.625 669.078 836.391 671.922 836.391ZM751.375 836.859C754.469 836.859 757.172 835.922 759.484 834.047C761.797 832.172 763.078 829.828 763.328 827.016H771.531C771.375 829.922 770.375 832.688 768.531 835.312C766.688 837.938 764.219 840.031 761.125 841.594C758.062 843.156 754.812 843.938 751.375 843.938C744.469 843.938 738.969 841.641 734.875 837.047C730.812 832.422 728.781 826.109 728.781 818.109V816.656C728.781 811.719 729.688 807.328 731.5 803.484C733.312 799.641 735.906 796.656 739.281 794.531C742.688 792.406 746.703 791.344 751.328 791.344C757.016 791.344 761.734 793.047 765.484 796.453C769.266 799.859 771.281 804.281 771.531 809.719H763.328C763.078 806.438 761.828 803.75 759.578 801.656C757.359 799.531 754.609 798.469 751.328 798.469C746.922 798.469 743.5 800.062 741.062 803.25C738.656 806.406 737.453 810.984 737.453 816.984V818.625C737.453 824.469 738.656 828.969 741.062 832.125C743.469 835.281 746.906 836.859 751.375 836.859ZM789.953 798.422C793.797 793.703 798.797 791.344 804.953 791.344C815.672 791.344 821.078 797.391 821.172 809.484V843H812.5V809.438C812.469 805.781 811.625 803.078 809.969 801.328C808.344 799.578 805.797 798.703 802.328 798.703C799.516 798.703 797.047 799.453 794.922 800.953C792.797 802.453 791.141 804.422 789.953 806.859V843H781.281V771H789.953V798.422ZM865.469 843C864.969 842 864.562 840.219 864.25 837.656C860.219 841.844 855.406 843.938 849.812 843.938C844.812 843.938 840.703 842.531 837.484 839.719C834.297 836.875 832.703 833.281 832.703 828.938C832.703 823.656 834.703 819.562 838.703 816.656C842.734 813.719 848.391 812.25 855.672 812.25H864.109V808.266C864.109 805.234 863.203 802.828 861.391 801.047C859.578 799.234 856.906 798.328 853.375 798.328C850.281 798.328 847.688 799.109 845.594 800.672C843.5 802.234 842.453 804.125 842.453 806.344H833.734C833.734 803.812 834.625 801.375 836.406 799.031C838.219 796.656 840.656 794.781 843.719 793.406C846.812 792.031 850.203 791.344 853.891 791.344C859.734 791.344 864.312 792.812 867.625 795.75C870.938 798.656 872.656 802.672 872.781 807.797V831.141C872.781 835.797 873.375 839.5 874.562 842.25V843H865.469ZM851.078 836.391C853.797 836.391 856.375 835.688 858.812 834.281C861.25 832.875 863.016 831.047 864.109 828.797V818.391H857.312C846.688 818.391 841.375 821.5 841.375 827.719C841.375 830.438 842.281 832.562 844.094 834.094C845.906 835.625 848.234 836.391 851.078 836.391ZM898.141 780V792.281H907.609V798.984H898.141V830.438C898.141 832.469 898.562 834 899.406 835.031C900.25 836.031 901.688 836.531 903.719 836.531C904.719 836.531 906.094 836.344 907.844 835.969V843C905.562 843.625 903.344 843.938 901.188 843.938C897.312 843.938 894.391 842.766 892.422 840.422C890.453 838.078 889.469 834.75 889.469 830.438V798.984H880.234V792.281H889.469V780H898.141ZM984.438 818.203C984.438 825.922 982.672 832.141 979.141 836.859C975.609 841.578 970.828 843.938 964.797 843.938C958.641 843.938 953.797 841.984 950.266 838.078V862.5H941.594V792.281H949.516L949.938 797.906C953.469 793.531 958.375 791.344 964.656 791.344C970.75 791.344 975.562 793.641 979.094 798.234C982.656 802.828 984.438 809.219 984.438 817.406V818.203ZM975.766 817.219C975.766 811.5 974.547 806.984 972.109 803.672C969.672 800.359 966.328 798.703 962.078 798.703C956.828 798.703 952.891 801.031 950.266 805.688V829.922C952.859 834.547 956.828 836.859 962.172 836.859C966.328 836.859 969.625 835.219 972.062 831.938C974.531 828.625 975.766 823.719 975.766 817.219ZM1020.02 800.062C1018.7 799.844 1017.28 799.734 1015.75 799.734C1010.06 799.734 1006.2 802.156 1004.17 807V843H995.5V792.281H1003.94L1004.08 798.141C1006.92 793.609 1010.95 791.344 1016.17 791.344C1017.86 791.344 1019.14 791.562 1020.02 792V800.062ZM1024.8 817.172C1024.8 812.203 1025.77 807.734 1027.7 803.766C1029.67 799.797 1032.39 796.734 1035.86 794.578C1039.36 792.422 1043.34 791.344 1047.81 791.344C1054.72 791.344 1060.3 793.734 1064.55 798.516C1068.83 803.297 1070.97 809.656 1070.97 817.594V818.203C1070.97 823.141 1070.02 827.578 1068.11 831.516C1066.23 835.422 1063.53 838.469 1060 840.656C1056.5 842.844 1052.47 843.938 1047.91 843.938C1041.03 843.938 1035.45 841.547 1031.17 836.766C1026.92 831.984 1024.8 825.656 1024.8 817.781V817.172ZM1033.52 818.203C1033.52 823.828 1034.81 828.344 1037.41 831.75C1040.03 835.156 1043.53 836.859 1047.91 836.859C1052.31 836.859 1055.81 835.141 1058.41 831.703C1061 828.234 1062.3 823.391 1062.3 817.172C1062.3 811.609 1060.97 807.109 1058.31 803.672C1055.69 800.203 1052.19 798.469 1047.81 798.469C1043.53 798.469 1040.08 800.172 1037.45 803.578C1034.83 806.984 1033.52 811.859 1033.52 818.203ZM1084.75 843V798.984H1076.73V792.281H1084.75V787.969C1084.75 782.312 1086.36 777.906 1089.58 774.75C1092.83 771.594 1097.41 770.016 1103.31 770.016C1106.81 770.016 1111.23 770.969 1116.58 772.875L1115.12 780.188C1111.22 778.625 1107.5 777.844 1103.97 777.844C1100.25 777.844 1097.56 778.688 1095.91 780.375C1094.28 782.031 1093.47 784.531 1093.47 787.875V792.281H1103.83V798.984H1093.47V843H1084.75ZM1120.89 843H1112.17V792.281H1120.89V843ZM1144.42 843H1135.75V771H1144.42V843ZM1179.39 843.938C1172.52 843.938 1166.92 841.688 1162.61 837.188C1158.3 832.656 1156.14 826.609 1156.14 819.047V817.453C1156.14 812.422 1157.09 807.938 1159 804C1160.94 800.031 1163.62 796.938 1167.06 794.719C1170.53 792.469 1174.28 791.344 1178.31 791.344C1184.91 791.344 1190.03 793.516 1193.69 797.859C1197.34 802.203 1199.17 808.422 1199.17 816.516V820.125H1164.81C1164.94 825.125 1166.39 829.172 1169.17 832.266C1171.98 835.328 1175.55 836.859 1179.86 836.859C1182.92 836.859 1185.52 836.234 1187.64 834.984C1189.77 833.734 1191.62 832.078 1193.22 830.016L1198.52 834.141C1194.27 840.672 1187.89 843.938 1179.39 843.938ZM1178.31 798.469C1174.81 798.469 1171.88 799.75 1169.5 802.312C1167.12 804.844 1165.66 808.406 1165.09 813H1190.5V812.344C1190.25 807.938 1189.06 804.531 1186.94 802.125C1184.81 799.688 1181.94 798.469 1178.31 798.469ZM1242.48 843H1233.81V792.281H1242.48V843ZM1233.11 778.828C1233.11 777.422 1233.53 776.234 1234.38 775.266C1235.25 774.297 1236.53 773.812 1238.22 773.812C1239.91 773.812 1241.19 774.297 1242.06 775.266C1242.94 776.234 1243.38 777.422 1243.38 778.828C1243.38 780.234 1242.94 781.406 1242.06 782.344C1241.19 783.281 1239.91 783.75 1238.22 783.75C1236.53 783.75 1235.25 783.281 1234.38 782.344C1233.53 781.406 1233.11 780.234 1233.11 778.828ZM1264.61 792.281L1264.89 798.656C1268.77 793.781 1273.83 791.344 1280.08 791.344C1290.8 791.344 1296.2 797.391 1296.3 809.484V843H1287.62V809.438C1287.59 805.781 1286.75 803.078 1285.09 801.328C1283.47 799.578 1280.92 798.703 1277.45 798.703C1274.64 798.703 1272.17 799.453 1270.05 800.953C1267.92 802.453 1266.27 804.422 1265.08 806.859V843H1256.41V792.281H1264.61ZM1344.95 780V792.281H1354.42V798.984H1344.95V830.438C1344.95 832.469 1345.38 834 1346.22 835.031C1347.06 836.031 1348.5 836.531 1350.53 836.531C1351.53 836.531 1352.91 836.344 1354.66 835.969V843C1352.38 843.625 1350.16 843.938 1348 843.938C1344.12 843.938 1341.2 842.766 1339.23 840.422C1337.27 838.078 1336.28 834.75 1336.28 830.438V798.984H1327.05V792.281H1336.28V780H1344.95ZM1373.27 798.422C1377.11 793.703 1382.11 791.344 1388.27 791.344C1398.98 791.344 1404.39 797.391 1404.48 809.484V843H1395.81V809.438C1395.78 805.781 1394.94 803.078 1393.28 801.328C1391.66 799.578 1389.11 798.703 1385.64 798.703C1382.83 798.703 1380.36 799.453 1378.23 800.953C1376.11 802.453 1374.45 804.422 1373.27 806.859V843H1364.59V771H1373.27V798.422ZM1438.52 843.938C1431.64 843.938 1426.05 841.688 1421.73 837.188C1417.42 832.656 1415.27 826.609 1415.27 819.047V817.453C1415.27 812.422 1416.22 807.938 1418.12 804C1420.06 800.031 1422.75 796.938 1426.19 794.719C1429.66 792.469 1433.41 791.344 1437.44 791.344C1444.03 791.344 1449.16 793.516 1452.81 797.859C1456.47 802.203 1458.3 808.422 1458.3 816.516V820.125H1423.94C1424.06 825.125 1425.52 829.172 1428.3 832.266C1431.11 835.328 1434.67 836.859 1438.98 836.859C1442.05 836.859 1444.64 836.234 1446.77 834.984C1448.89 833.734 1450.75 832.078 1452.34 830.016L1457.64 834.141C1453.39 840.672 1447.02 843.938 1438.52 843.938ZM1437.44 798.469C1433.94 798.469 1431 799.75 1428.62 802.312C1426.25 804.844 1424.78 808.406 1424.22 813H1449.62V812.344C1449.38 807.938 1448.19 804.531 1446.06 802.125C1443.94 799.688 1441.06 798.469 1437.44 798.469ZM1501.61 843H1492.94V771H1501.61V843ZM1536.58 843.938C1529.7 843.938 1524.11 841.688 1519.8 837.188C1515.48 832.656 1513.33 826.609 1513.33 819.047V817.453C1513.33 812.422 1514.28 807.938 1516.19 804C1518.12 800.031 1520.81 796.938 1524.25 794.719C1527.72 792.469 1531.47 791.344 1535.5 791.344C1542.09 791.344 1547.22 793.516 1550.88 797.859C1554.53 802.203 1556.36 808.422 1556.36 816.516V820.125H1522C1522.12 825.125 1523.58 829.172 1526.36 832.266C1529.17 835.328 1532.73 836.859 1537.05 836.859C1540.11 836.859 1542.7 836.234 1544.83 834.984C1546.95 833.734 1548.81 832.078 1550.41 830.016L1555.7 834.141C1551.45 840.672 1545.08 843.938 1536.58 843.938ZM1535.5 798.469C1532 798.469 1529.06 799.75 1526.69 802.312C1524.31 804.844 1522.84 808.406 1522.28 813H1547.69V812.344C1547.44 807.938 1546.25 804.531 1544.12 802.125C1542 799.688 1539.12 798.469 1535.5 798.469ZM1570.7 843V798.984H1562.69V792.281H1570.7V787.078C1570.7 781.641 1572.16 777.438 1575.06 774.469C1577.97 771.5 1582.08 770.016 1587.39 770.016C1589.39 770.016 1591.38 770.281 1593.34 770.812L1592.88 777.844C1591.41 777.562 1589.84 777.422 1588.19 777.422C1585.38 777.422 1583.2 778.25 1581.67 779.906C1580.14 781.531 1579.38 783.875 1579.38 786.938V792.281H1590.2V798.984H1579.38V843H1570.7ZM1611.58 780V792.281H1621.05V798.984H1611.58V830.438C1611.58 832.469 1612 834 1612.84 835.031C1613.69 836.031 1615.12 836.531 1617.16 836.531C1618.16 836.531 1619.53 836.344 1621.28 835.969V843C1619 843.625 1616.78 843.938 1614.62 843.938C1610.75 843.938 1607.83 842.766 1605.86 840.422C1603.89 838.078 1602.91 834.75 1602.91 830.438V798.984H1593.67V792.281H1602.91V780H1611.58ZM426.438 942.547C426.438 940.203 425.547 938.391 423.766 937.109C422.016 935.797 418.938 934.672 414.531 933.734C410.156 932.797 406.672 931.672 404.078 930.359C401.516 929.047 399.609 927.484 398.359 925.672C397.141 923.859 396.531 921.703 396.531 919.203C396.531 915.047 398.281 911.531 401.781 908.656C405.312 905.781 409.812 904.344 415.281 904.344C421.031 904.344 425.688 905.828 429.25 908.797C432.844 911.766 434.641 915.562 434.641 920.188H425.922C425.922 917.812 424.906 915.766 422.875 914.047C420.875 912.328 418.344 911.469 415.281 911.469C412.125 911.469 409.656 912.156 407.875 913.531C406.094 914.906 405.203 916.703 405.203 918.922C405.203 921.016 406.031 922.594 407.688 923.656C409.344 924.719 412.328 925.734 416.641 926.703C420.984 927.672 424.5 928.828 427.188 930.172C429.875 931.516 431.859 933.141 433.141 935.047C434.453 936.922 435.109 939.219 435.109 941.938C435.109 946.469 433.297 950.109 429.672 952.859C426.047 955.578 421.344 956.938 415.562 956.938C411.5 956.938 407.906 956.219 404.781 954.781C401.656 953.344 399.203 951.344 397.422 948.781C395.672 946.188 394.797 943.391 394.797 940.391H403.469C403.625 943.297 404.781 945.609 406.938 947.328C409.125 949.016 412 949.859 415.562 949.859C418.844 949.859 421.469 949.203 423.438 947.891C425.438 946.547 426.438 944.766 426.438 942.547ZM455.828 956H447.156V905.281H455.828V956ZM446.453 891.828C446.453 890.422 446.875 889.234 447.719 888.266C448.594 887.297 449.875 886.812 451.562 886.812C453.25 886.812 454.531 887.297 455.406 888.266C456.281 889.234 456.719 890.422 456.719 891.828C456.719 893.234 456.281 894.406 455.406 895.344C454.531 896.281 453.25 896.75 451.562 896.75C449.875 896.75 448.594 896.281 447.719 895.344C446.875 894.406 446.453 893.234 446.453 891.828ZM467.641 930.219C467.641 922.438 469.484 916.188 473.172 911.469C476.859 906.719 481.688 904.344 487.656 904.344C493.594 904.344 498.297 906.375 501.766 910.438V884H510.438V956H502.469L502.047 950.562C498.578 954.812 493.75 956.938 487.562 956.938C481.688 956.938 476.891 954.531 473.172 949.719C469.484 944.906 467.641 938.625 467.641 930.875V930.219ZM476.312 931.203C476.312 936.953 477.5 941.453 479.875 944.703C482.25 947.953 485.531 949.578 489.719 949.578C495.219 949.578 499.234 947.109 501.766 942.172V918.875C499.172 914.094 495.188 911.703 489.812 911.703C485.562 911.703 482.25 913.344 479.875 916.625C477.5 919.906 476.312 924.766 476.312 931.203ZM544.984 956.938C538.109 956.938 532.516 954.688 528.203 950.188C523.891 945.656 521.734 939.609 521.734 932.047V930.453C521.734 925.422 522.688 920.938 524.594 917C526.531 913.031 529.219 909.938 532.656 907.719C536.125 905.469 539.875 904.344 543.906 904.344C550.5 904.344 555.625 906.516 559.281 910.859C562.938 915.203 564.766 921.422 564.766 929.516V933.125H530.406C530.531 938.125 531.984 942.172 534.766 945.266C537.578 948.328 541.141 949.859 545.453 949.859C548.516 949.859 551.109 949.234 553.234 947.984C555.359 946.734 557.219 945.078 558.812 943.016L564.109 947.141C559.859 953.672 553.484 956.938 544.984 956.938ZM543.906 911.469C540.406 911.469 537.469 912.75 535.094 915.312C532.719 917.844 531.25 921.406 530.688 926H556.094V925.344C555.844 920.938 554.656 917.531 552.531 915.125C550.406 912.688 547.531 911.469 543.906 911.469ZM617.781 931.203C617.781 938.953 616 945.188 612.438 949.906C608.875 954.594 604.094 956.938 598.094 956.938C591.688 956.938 586.734 954.672 583.234 950.141L582.812 956H574.844V884H583.516V910.859C587.016 906.516 591.844 904.344 598 904.344C604.156 904.344 608.984 906.672 612.484 911.328C616.016 915.984 617.781 922.359 617.781 930.453V931.203ZM609.109 930.219C609.109 924.312 607.969 919.75 605.688 916.531C603.406 913.312 600.125 911.703 595.844 911.703C590.125 911.703 586.016 914.359 583.516 919.672V941.609C586.172 946.922 590.312 949.578 595.938 949.578C600.094 949.578 603.328 947.969 605.641 944.75C607.953 941.531 609.109 936.688 609.109 930.219ZM660.062 956C659.562 955 659.156 953.219 658.844 950.656C654.812 954.844 650 956.938 644.406 956.938C639.406 956.938 635.297 955.531 632.078 952.719C628.891 949.875 627.297 946.281 627.297 941.938C627.297 936.656 629.297 932.562 633.297 929.656C637.328 926.719 642.984 925.25 650.266 925.25H658.703V921.266C658.703 918.234 657.797 915.828 655.984 914.047C654.172 912.234 651.5 911.328 647.969 911.328C644.875 911.328 642.281 912.109 640.188 913.672C638.094 915.234 637.047 917.125 637.047 919.344H628.328C628.328 916.812 629.219 914.375 631 912.031C632.812 909.656 635.25 907.781 638.312 906.406C641.406 905.031 644.797 904.344 648.484 904.344C654.328 904.344 658.906 905.812 662.219 908.75C665.531 911.656 667.25 915.672 667.375 920.797V944.141C667.375 948.797 667.969 952.5 669.156 955.25V956H660.062ZM645.672 949.391C648.391 949.391 650.969 948.688 653.406 947.281C655.844 945.875 657.609 944.047 658.703 941.797V931.391H651.906C641.281 931.391 635.969 934.5 635.969 940.719C635.969 943.438 636.875 945.562 638.688 947.094C640.5 948.625 642.828 949.391 645.672 949.391ZM705.484 913.062C704.172 912.844 702.75 912.734 701.219 912.734C695.531 912.734 691.672 915.156 689.641 920V956H680.969V905.281H689.406L689.547 911.141C692.391 906.609 696.422 904.344 701.641 904.344C703.328 904.344 704.609 904.562 705.484 905V913.062ZM749.078 893V905.281H758.547V911.984H749.078V943.438C749.078 945.469 749.5 947 750.344 948.031C751.188 949.031 752.625 949.531 754.656 949.531C755.656 949.531 757.031 949.344 758.781 948.969V956C756.5 956.625 754.281 956.938 752.125 956.938C748.25 956.938 745.328 955.766 743.359 953.422C741.391 951.078 740.406 947.75 740.406 943.438V911.984H731.172V905.281H740.406V893H749.078ZM765.484 930.172C765.484 925.203 766.453 920.734 768.391 916.766C770.359 912.797 773.078 909.734 776.547 907.578C780.047 905.422 784.031 904.344 788.5 904.344C795.406 904.344 800.984 906.734 805.234 911.516C809.516 916.297 811.656 922.656 811.656 930.594V931.203C811.656 936.141 810.703 940.578 808.797 944.516C806.922 948.422 804.219 951.469 800.688 953.656C797.188 955.844 793.156 956.938 788.594 956.938C781.719 956.938 776.141 954.547 771.859 949.766C767.609 944.984 765.484 938.656 765.484 930.781V930.172ZM774.203 931.203C774.203 936.828 775.5 941.344 778.094 944.75C780.719 948.156 784.219 949.859 788.594 949.859C793 949.859 796.5 948.141 799.094 944.703C801.688 941.234 802.984 936.391 802.984 930.172C802.984 924.609 801.656 920.109 799 916.672C796.375 913.203 792.875 911.469 788.5 911.469C784.219 911.469 780.766 913.172 778.141 916.578C775.516 919.984 774.203 924.859 774.203 931.203ZM866.688 949.859C869.781 949.859 872.484 948.922 874.797 947.047C877.109 945.172 878.391 942.828 878.641 940.016H886.844C886.688 942.922 885.688 945.688 883.844 948.312C882 950.938 879.531 953.031 876.438 954.594C873.375 956.156 870.125 956.938 866.688 956.938C859.781 956.938 854.281 954.641 850.188 950.047C846.125 945.422 844.094 939.109 844.094 931.109V929.656C844.094 924.719 845 920.328 846.812 916.484C848.625 912.641 851.219 909.656 854.594 907.531C858 905.406 862.016 904.344 866.641 904.344C872.328 904.344 877.047 906.047 880.797 909.453C884.578 912.859 886.594 917.281 886.844 922.719H878.641C878.391 919.438 877.141 916.75 874.891 914.656C872.672 912.531 869.922 911.469 866.641 911.469C862.234 911.469 858.812 913.062 856.375 916.25C853.969 919.406 852.766 923.984 852.766 929.984V931.625C852.766 937.469 853.969 941.969 856.375 945.125C858.781 948.281 862.219 949.859 866.688 949.859ZM894.297 930.172C894.297 925.203 895.266 920.734 897.203 916.766C899.172 912.797 901.891 909.734 905.359 907.578C908.859 905.422 912.844 904.344 917.312 904.344C924.219 904.344 929.797 906.734 934.047 911.516C938.328 916.297 940.469 922.656 940.469 930.594V931.203C940.469 936.141 939.516 940.578 937.609 944.516C935.734 948.422 933.031 951.469 929.5 953.656C926 955.844 921.969 956.938 917.406 956.938C910.531 956.938 904.953 954.547 900.672 949.766C896.422 944.984 894.297 938.656 894.297 930.781V930.172ZM903.016 931.203C903.016 936.828 904.312 941.344 906.906 944.75C909.531 948.156 913.031 949.859 917.406 949.859C921.812 949.859 925.312 948.141 927.906 944.703C930.5 941.234 931.797 936.391 931.797 930.172C931.797 924.609 930.469 920.109 927.812 916.672C925.188 913.203 921.688 911.469 917.312 911.469C913.031 911.469 909.578 913.172 906.953 916.578C904.328 919.984 903.016 924.859 903.016 931.203ZM959.547 905.281L959.828 911.656C963.703 906.781 968.766 904.344 975.016 904.344C985.734 904.344 991.141 910.391 991.234 922.484V956H982.562V922.438C982.531 918.781 981.688 916.078 980.031 914.328C978.406 912.578 975.859 911.703 972.391 911.703C969.578 911.703 967.109 912.453 964.984 913.953C962.859 915.453 961.203 917.422 960.016 919.859V956H951.344V905.281H959.547ZM1016.08 893V905.281H1025.55V911.984H1016.08V943.438C1016.08 945.469 1016.5 947 1017.34 948.031C1018.19 949.031 1019.62 949.531 1021.66 949.531C1022.66 949.531 1024.03 949.344 1025.78 948.969V956C1023.5 956.625 1021.28 956.938 1019.12 956.938C1015.25 956.938 1012.33 955.766 1010.36 953.422C1008.39 951.078 1007.41 947.75 1007.41 943.438V911.984H998.172V905.281H1007.41V893H1016.08ZM1045.14 956H1036.47V905.281H1045.14V956ZM1035.77 891.828C1035.77 890.422 1036.19 889.234 1037.03 888.266C1037.91 887.297 1039.19 886.812 1040.88 886.812C1042.56 886.812 1043.84 887.297 1044.72 888.266C1045.59 889.234 1046.03 890.422 1046.03 891.828C1046.03 893.234 1045.59 894.406 1044.72 895.344C1043.84 896.281 1042.56 896.75 1040.88 896.75C1039.19 896.75 1037.91 896.281 1037.03 895.344C1036.19 894.406 1035.77 893.234 1035.77 891.828ZM1067.27 905.281L1067.55 911.656C1071.42 906.781 1076.48 904.344 1082.73 904.344C1093.45 904.344 1098.86 910.391 1098.95 922.484V956H1090.28V922.438C1090.25 918.781 1089.41 916.078 1087.75 914.328C1086.12 912.578 1083.58 911.703 1080.11 911.703C1077.3 911.703 1074.83 912.453 1072.7 913.953C1070.58 915.453 1068.92 917.422 1067.73 919.859V956H1059.06V905.281H1067.27ZM1143.34 950.984C1139.97 954.953 1135.02 956.938 1128.48 956.938C1123.08 956.938 1118.95 955.375 1116.11 952.25C1113.3 949.094 1111.88 944.438 1111.84 938.281V905.281H1120.52V938.047C1120.52 945.734 1123.64 949.578 1129.89 949.578C1136.52 949.578 1140.92 947.109 1143.11 942.172V905.281H1151.78V956H1143.53L1143.34 950.984ZM1186.05 956.938C1179.17 956.938 1173.58 954.688 1169.27 950.188C1164.95 945.656 1162.8 939.609 1162.8 932.047V930.453C1162.8 925.422 1163.75 920.938 1165.66 917C1167.59 913.031 1170.28 909.938 1173.72 907.719C1177.19 905.469 1180.94 904.344 1184.97 904.344C1191.56 904.344 1196.69 906.516 1200.34 910.859C1204 915.203 1205.83 921.422 1205.83 929.516V933.125H1171.47C1171.59 938.125 1173.05 942.172 1175.83 945.266C1178.64 948.328 1182.2 949.859 1186.52 949.859C1189.58 949.859 1192.17 949.234 1194.3 947.984C1196.42 946.734 1198.28 945.078 1199.88 943.016L1205.17 947.141C1200.92 953.672 1194.55 956.938 1186.05 956.938ZM1184.97 911.469C1181.47 911.469 1178.53 912.75 1176.16 915.312C1173.78 917.844 1172.31 921.406 1171.75 926H1197.16V925.344C1196.91 920.938 1195.72 917.531 1193.59 915.125C1191.47 912.688 1188.59 911.469 1184.97 911.469ZM1216.09 951.453C1216.09 949.953 1216.53 948.703 1217.41 947.703C1218.31 946.703 1219.66 946.203 1221.44 946.203C1223.22 946.203 1224.56 946.703 1225.47 947.703C1226.41 948.703 1226.88 949.953 1226.88 951.453C1226.88 952.891 1226.41 954.094 1225.47 955.062C1224.56 956.031 1223.22 956.516 1221.44 956.516C1219.66 956.516 1218.31 956.031 1217.41 955.062C1216.53 954.094 1216.09 952.891 1216.09 951.453Z"
                fill="black"
              />
            </svg>
          </Box>
        )}
      </Paper>
    </>
  );
}

function Chat({ recieverId, recieverDetails, threadId, myUid }) {
  const messagesEndRef = useRef(null);
  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: "smooth" });
  };

  const [messageData, setMessageData] = useState();

  const getMessages = () => {
    const db = getDatabase();
    const threadRef = ref(db, "threads/" + threadId);
    // const limitToFirstDataRef = query(threadRef, limitToLast(40)); this works but not using currently because did not find any use case
    return onValue(threadRef, (threadDataSnapshot) => {
      const threadData = threadDataSnapshot.val();
      setMessageData(threadData);
      scrollToBottom();
    });
  };
  const updateStatusToDelivered = () => {
    const db = getDatabase();
    const unreadMessagesRef = ref(db, `users/${myUid}/contacts/${recieverId}`);
    return onValue(unreadMessagesRef, (snapshot) => {
      const data = snapshot.val();
      const threadIdValue = data["threadId"];
      const unReadData = data["unread"];
      if (unReadData && threadIdValue) {
        console.log(unReadData);
        Object.keys(unReadData).map((key) => {
          const updates = {};
          updates[`threads/${threadIdValue}/${key}/status`] = "seen";
          updates[`users/${myUid}/contacts/${recieverId}/unread/${key}`] = null;
          update(ref(db), updates);
        });
      }
    });
  };

  useEffect(() => {
    let unsubscribeUpdateStatusRef;
    let unsubscribeThreadRef;
    unsubscribeThreadRef = getMessages();
    unsubscribeUpdateStatusRef = updateStatusToDelivered();
    return () => {
      if (unsubscribeUpdateStatusRef) {
        unsubscribeUpdateStatusRef();
      }
      if (unsubscribeThreadRef) {
        unsubscribeThreadRef();
      }
    };
  }, [recieverId, threadId, myUid]);

  return (
    <>
      <Paper
        elevation={3}
        sx={{
          padding: 2,
        }}
      >
        <Stack
          direction="row"
          justifyContent="space-between"
          alignItems="center"
          spacing={2}
        >
          <Stack
            direction="row"
            justifyContent="space-around"
            alignItems="center"
            spacing={2}
          >
            <Avatar
              alt={"Chat Profile Image" + recieverDetails?.photoURL}
              src={recieverDetails?.photoURL}
            />
            <Typography variant="h6" component="h6">
              {recieverDetails?.name}
            </Typography>
          </Stack>

          <IconButton
            color="primary"
            aria-label="upload picture"
            component="span"
          >
            <ArrowDropDownIcon />
          </IconButton>
        </Stack>
      </Paper>
      <Box
        sx={{
          padding: 2,
          flexGrow: "1",
          overflowY: "scroll",
        }}
      >
        {myUid &&
          messageData &&
          Object.keys(messageData).map((msg) => (
            <Message key={msg} message={messageData[msg]} myUid={myUid} />
          ))}
        <div ref={messagesEndRef} />
      </Box>
      <Box>
        <SendMessageComponent
          senderId={myUid}
          recieverId={recieverId}
          threadId={threadId}
        />
      </Box>
    </>
  );
}

function SendMessageComponent({ senderId, recieverId, threadId }) {
  const [value, setValue] = useState("");
  const handleChange = (event) => {
    setValue(event.target.value);
  };

  const sendNotification = async (registrationToken, sender, message) => {
    const config = {
      headers: {
        "Content-Type": "application/json",
      },
    };
    await Axios.post(
      "https://simple-p2p-chat-server.herokuapp.com/firebase/notification",
      {
        registrationToken: registrationToken,
        message: {
          notification: {
            title: sender,
            body: message,
          },
        },
      },
      config
    );
  };

  const getToken = async (id) => {
    const db = getDatabase();
    get(child(ref(db), `users/${id}/fcm_token`))
      .then((snapshot) => {
        if (snapshot.exists()) {
          return snapshot.val();
        } else {
          console.error("No data available");
        }
      })
      .catch((error) => {
        console.error(error.message);
      });
  };

  const getSenderName = async (id) => {
    const db = getDatabase();
    get(child(ref(db), `users/${id}/details/name`))
      .then((snapshot) => {
        if (snapshot.exists()) {
          return snapshot.val();
        } else {
          console.error("No data available");
        }
      })
      .catch((error) => {
        console.error(error.message);
      });
  };
  const sendMessage = async () => {
    if (value) {
      let messageObj = {
        message: value,
        by: senderId,
        createdAt: serverTimestamp(),
        status: "sent",
      };
      const db = getDatabase();
      const registrationToken = await getToken(recieverId);
      const senderName = await getSenderName(senderId);
      const newMessageKey = push(child(ref(db), `threads/${threadId}`)).key;
      const updates = {};
      updates[`threads/${threadId}/${newMessageKey}`] = messageObj;
      updates[
        `users/${recieverId}/contacts/${senderId}/unread/${newMessageKey}`
      ] = false;
      setValue("");
      const disconnection = await update(ref(db), updates);
      sendNotification(registrationToken, senderName, value);
      return disconnection;
    }
  };
  return (
    <Paper
      elevation={3}
      sx={{
        padding: 2,
      }}
    >
      <Grid container spacing={1}>
        <Grid item xs={11}>
          <TextField
            id="send-message"
            label="Send Message"
            multiline
            maxRows={4}
            value={value}
            onChange={handleChange}
            fullWidth
          />
        </Grid>
        <Grid item xs={1}>
          <Button
            sx={{ height: "100%", width: "100%" }}
            color="primary"
            aria-label="send"
            component="span"
            variant="contained"
            onClick={sendMessage}
          >
            <SendIcon />
          </Button>
        </Grid>
      </Grid>
    </Paper>
  );
}

function Message({ message, myUid }) {
  if (message.by == myUid) {
    return (
      <Grid container sx={{ my: 1 }}>
        <Grid item xs={4} md={5}></Grid>
        <Grid item xs={8} md={7}>
          <Paper elevation={2} sx={{ padding: 1 }}>
            <Typography variant="body2">{message.message}</Typography>
            <Stack
              flexDirection={"row"}
              alignItems={"center"}
              justifyContent={"flex-end"}
            >
              <Typography variant="caption" component="div" sx={{ px: 1 }}>
                {Date(message.createdAt * 1000)
                  .toString()
                  .substring(4, 21)}
              </Typography>
              <RenderStatus status={message.status} />
            </Stack>
          </Paper>
        </Grid>
      </Grid>
    );
  } else {
    return (
      <Grid container sx={{ my: 1 }}>
        <Grid item xs={8} md={7}>
          <Paper elevation={2} sx={{ padding: 1 }}>
            <Typography variant="body2">{message.message}</Typography>
            <Stack
              flexDirection={"row"}
              alignItems={"center"}
              justifyContent={"flex-end"}
            >
              <Typography variant="caption" component="div" sx={{ px: 1 }}>
                {Date(message.createdAt * 1000)
                  .toString()
                  .substring(4, 21)}
              </Typography>
            </Stack>
          </Paper>
        </Grid>
      </Grid>
    );
  }
}

function RenderStatus({ status }) {
  if (status == "sent") {
    return <DoneIcon fontSize={"small"} />;
  } else if (status == "delivered") {
    return <DoneAllIcon fontSize="small" />;
  } else if (status == "seen") {
    return <DoneAllIcon fontSize="small" color="info" />;
  }
  return <></>;
}
